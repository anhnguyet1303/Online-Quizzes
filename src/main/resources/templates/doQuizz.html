<!DOCTYPE html>
<html lang="en">
<head>
    <div th:replace="HomeHead :: head"></div>
    <title>Quiz</title>
    <link rel="stylesheet" type="text/css" media="all" href="/css/doQuiz.css" th:href="@{/css/doQuiz.css}">
</head>
<body id="top">

    <div class="Header">
        <div th:replace="~{HomeHeader :: header}"></div>
    </div>
    <div class="Container">
        <form th:action="@{/attempt/progress}" th:object="${QuizProgress}" method="post">
            <!----Tên quizzz - Tên môn--->
            <input type="hidden" name="page" th:value="${page}" />
            <input type="hidden" name="questionID" th:value="${question.getQuestionId()}">
            <input type="hidden" name="attempID" th:value="${attemp.getAttemptId()}">
            <div class="qtext">
                <h1 th:text="${quiz.getQuizName()} + ' - ' + ${quiz.getSubject().getSubjectName()}"></h1>
            </div>
            <div id="timeRemaining"></div>
            <!-----Nội dung câu hỏi------>
            <div class="card-contenain">
                <div class="card">
                    <div class="info">
                        <h3 class="no">Question <span class="qno" th:text="${page}"></span></h3>
                    </div>
                    <div class="content">
                        <h2 class="question" th:text="${question.getQuestionContent()}"></h2>
                        <div class="answer" th:each="answer, answerIndex : ${question.getListAnswer()}">
                            <div class="r0">
                                <input type="radio" name="answer" th:field="*{answer}" th:value="${answer.getAnswerId()}"
                                    th:id="'answer_' + ${answerIndex.index}">
                                <script th:inline="javascript">
                                    /*<![CDATA[*/
                                    var answerProg = /*[[${answerProg}]]*/ null; // Assuming answerProg is a variable from the server-side
                                    var answerId = /*[[${answer.getAnswerId()}]]*/ null; // Get the answer ID from Thymeleaf
                                    // Check the radio button if answerProg is equal to the answer ID
                                    if (answerProg !== null && answerId !== null && answerProg === answerId) {
                                        // Use the dynamically generated ID based on the answer index
                                        document.getElementById('answer_' + /*[[${answerIndex.index}]]*/ '').checked = true;
                                    }
                                    /*]]>*/
                                </script>
                                <label for="q1034657:1_answer0" class="m-l-1">
                                    <span class="answernumber"
                                        th:text="${answerIndex.index + 1} + '. ' + ${answer.getAnswerContent()}"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <!----Tiến trình câu hỏi ------->
                <section id="mod_quiz_navblock" class=" block block__fake  card mb-3" role="navigation" data-block="_fake"
                    aria-labelledby="instance-0-header">
                    <div class="card-body p-3">
                        <div class="card-text content mt-3">
                            <div class="qn_buttons clearfix multipages"
                                th:each="quizProgress2, quizProgress2Index : ${listQProg}">
                                <a class="qnbutton complete free btn btn-secondary thispage" id="quiznavbutton1"
                                    title="Not answered" data-quiz-page="0" href="/attempt/test"
                                    th:href="@{/attempt/attemptQuiz/{quizID}/{attemptID}/{page}(quizID = ${quiz.getQuizId()}, attemptID = ${attemp.getAttemptId()}, page = ${quizProgress2.getQuestionOrder()})}">
                                    <span class="thispageholder"></span>
                                    <span class="trafficlight"></span>
                                    <span class="accesshide"
                                        th:text="'Question' + ${quizProgress2.getQuestionOrder()}"></span><span
                                        class="accesshide"><span class="flagstate"></span></span>
                                </a>
                            </div>
                        </div>
                        <div class="othernav">
                            <a id="submitButton" onclick="submitQuiz()" class="mod_quiz-next-nav" href="/attempt/test"
                                th:href="@{/attempt/attemptQuiz/{quizID}/{attemptID}/finish(quizID = ${quiz.getQuizId()}, attemptID = ${attemp.getAttemptId()})}">Finish
                                quiz</a>
                            <script th:inline="javascript">
                                /*<![CDATA[*/
                                // Đặt thời gian kết thúc (đọc từ model hoặc server)
                                var endTime = /*[[${endTime}]]*/ 0;
                                // Cập nhật thời gian còn lại mỗi giây
                                var countdownInterval = setInterval(function () {
                                    var now = new Date().getTime();
                                    var timeRemaining = endTime - now;
                                    // Tính toán phút và giây còn lại
                                    var hour = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                    var minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
                                    var seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
                                    // Hiển thị thời gian còn lại
                                    document.getElementById("timeRemaining").innerHTML = "Time Remaining: " + hour + "h " + minutes + "m " + seconds + "s ";
                                    if (timeRemaining <= 0) {
                                        clearInterval(countdownInterval);
                                        submitQuiz();
                                        document.getElementById("submitQuizLink").style.pointerEvents = "none";
                                    }
                                }, 1000);
                                function submitQuiz() {
                                    document.getElementById("submitButton").click();
                                }
                                /*]]>*/
                            </script>
                        </div>
                    </div>
    
                </section>
            </div>
            <!---Buttonm next & previous---->
            <div class="button-load">
                <button type="submit" name="previous" value="Previous page" class="btn btn-secondary button type1"><span
                        class="btn-txt">Previous page</span></button>
                <button type="submit" name="next" value="Next page" class="btn btn-secondary button type1"><span
                        class="btn-txt">Next page</span></button>
            </div>
        </form>
    </div>
    <div class="Footer">
        <div th:replace="~{HomeFooter :: footer}"></div>
    </div>


<div th:replace="~{HomeScript :: script}"></div>

</body>

</html>